name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    name: Create Release
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Generate changelog
      id: changelog
      uses: actions/github-script@v7
      with:
        script: |
          const { data: commits } = await github.rest.repos.compareCommits({
            owner: context.repo.owner,
            repo: context.repo.repo,
            base: 'main',
            head: context.sha
          });
          
          const changelog = commits.commits
            .map(commit => `- ${commit.commit.message}`)
            .join('\n');
          
          return changelog;
    
    - name: Create Release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        draft: false
        prerelease: false
        body: |
          ## 🚀 Hysteria2 VPN Client Release ${{ github.ref }}
          
          ### 📱 Supported Platforms
          - **Android**: APK & AAB packages
          - **iOS**: Archive & Simulator builds
          - **Windows**: Native Windows application
          - **Linux**: Native Linux application
          - **macOS**: Native macOS application
          - **Web**: Progressive Web App
          - **Docker**: Multi-platform container
          
          ### 🔧 Build Information
          - **Commit**: ${{ github.sha }}
          - **Branch**: ${{ github.ref_name }}
          - **Build Date**: ${{ github.event.head_commit.timestamp }}
          
          ### 📝 Changelog
          ${{ steps.changelog.outputs.result }}
          
          ### 📦 Downloads
          Build artifacts will be available once the CI/CD pipeline completes.
          
          ### 🐛 Bug Reports
          If you encounter any issues, please report them on our [GitHub Issues](https://github.com/${{ github.repository }}/issues) page.
          
          ### 🔗 Links
          - [Documentation](https://github.com/${{ github.repository }}/blob/main/README.md)
          - [Changelog](https://github.com/${{ github.repository }}/releases)
          - [Issues](https://github.com/${{ github.repository }}/issues)
